<?xml version="1.0" encoding="UTF-8"?>

<!--L
   Copyright SAIC, Ellumen and RSNA (CTP)


   Distributed under the OSI-approved BSD 3-Clause License.
   See http://ncip.github.com/national-biomedical-image-archive/LICENSE.txt for details.
L-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ice="http://www.icesoft.com/icefaces/component">

<f:subview id="notWaitingView">
<!--  ensure this is in naming container so resultTable isnt dupe -->  
<ice:panelGroup id="patientResultsPanelGroup"
                rendered="#{not empty perNodeResult.patients and not perNodeResult.errorState}">
<div id="tabD" align="center">
  <ice:dataTable id="patientResultsTable" 
                 value="#{perNodeResult.patients}" 
                 var="result" 
                 rows="#{searchResultBean.resultsPerPage}" 
                 scrollable="true" scrollHeight="43.3em"
                 style="padding-top: 0px;  margin: 0px 0 0 0; text-align: center;"
                 styleClass="contentPage"
                 columnWidths="45em,40%,10%,10%,9%,8%,5%">
    <h:column id="collectionIdColumn">
      <f:facet name="header">
        <h:panelGroup>
          <h:outputText value="#{msg.common_trialId}" />
        </h:panelGroup>
      </f:facet>
      <div class="#{empty basketBean.patientInBasketMap[result.basketKey] ? '' : 'highlightedData'}">
        <h:outputText value="#{result.patient.project}" />
      </div>
    </h:column>
    <h:column id="subjectIdColumn">
      <f:facet name="header">
        <h:panelGroup>
          <h:outputText value="#{msg.common_subjectId}" />
         
        </h:panelGroup>
      </f:facet>
      <div class="#{empty basketBean.patientInBasketMap[result.basketKey] ? '' : 'highlightedData'}">
        <h:commandLink id="viewPatientLink"
	                       value="#{result.patient.subjectId}"
	                       action="#{perNodeResult.navPatient}"
                       actionListener="#{perNodeResult.viewPatient}" />
      </div>
    </h:column>
    <h:column id="matchStudiesCountColumn">
      <f:facet name="header">
        <h:panelGroup>
          <h:outputText value="Matched #{msg.common_studies}" />
        </h:panelGroup>
      </f:facet>
      <div class="#{empty basketBean.patientInBasketMap[result.basketKey] ? '' : 'highlightedData'}">
        <h:outputText value="#{result.studyCounts}"  />
      </div>
    </h:column>
    <h:column id="totalStudiesCountColumn">
          <f:facet name="header">
            <h:panelGroup>
              <h:outputText value="Total #{msg.common_studies}" />
            </h:panelGroup>
          </f:facet>
          <div class="#{empty basketBean.patientInBasketMap[result.basketKey] ? '' : 'highlightedData'}">
            <h:outputText value="#{result.patient.totalNumberOfStudies}"  />
          </div>
    </h:column>
    <h:column id="matchedSeriesCountColumn">
      <f:facet name="header">
        <h:panelGroup>
          <h:outputText value="Matched #{msg.common_series}" />
        </h:panelGroup>
      </f:facet>
      <div class="#{empty basketBean.patientInBasketMap[result.basketKey] ? '' : 'highlightedData'}">
        <h:outputText value="#{result.seriesCounts}" />
      </div>
    </h:column>
    <h:column id="totalSeriesCountColumn">
          <f:facet name="header">
            <h:panelGroup>
              <h:outputText value="Total #{msg.common_series}" />
            </h:panelGroup>
          </f:facet>
          <div class="#{empty basketBean.patientInBasketMap[result.basketKey] ? '' : 'highlightedData'}">
            <h:outputText value="#{result.patient.totalNumberOfStudies}" />
          </div>
    </h:column>
    <h:column id="addToBasketColumn">
    <f:facet name="header">
     	<h:commandButton action="#" image="images/cart-empty.png"/>
            
      </f:facet>       
      <div class="#{empty basketBean.patientInBasketMap[result.basketKey] ? '' : 'highlightedData'}">
        <div align="center" class="formFieldWhite">
          <h:selectBooleanCheckbox id="addPatientToBasketCheckbox" style="display: none;" 
                                   value="#{result.checked}" />
          <h:commandButton action="#{perNodeResult.addPatientToBasket}"
          			   rendered ="#{empty basketBean.patientInBasketMap[result.basketKey]}"
                                   image="images/add-icon.png" 
                                   title="Add To Basket">                         
	<f:setPropertyActionListener target="#{perNodeResult.toAdd}" value="#{result.patient.id}"/>
	
	  </h:commandButton>  
	  <h:commandButton action="#{perNodeResult.removePatientFromBasket}"
          			   rendered ="#{basketBean.patientInBasketMap[result.basketKey]}"
                                   image="images/remove_icon.png" 
                                   title="Remove From Basket">                                                             
	<f:setPropertyActionListener target="#{perNodeResult.toAdd}" value="#{result.patient.id}"/>
          </h:commandButton>                                                           
        </div>
      </div>
    </h:column>                   
  </ice:dataTable>
  <ui:include src="searchResultPaginator.xhtml"/>
  </div>
</ice:panelGroup>



<f:subview id="noResultView" 
           rendered="#{empty perNodeResult.patients and not perNodeResult.errorState}">
  <table width="100%" cellpadding="3" cellspacing="0" border="1" class="formLabel">
    <tr>
      <td>
        <h:outputText value="#{msg.search_noResults}" />
      </td>
    </tr>
  </table>
</f:subview>                  

<f:subview id="errorView" 
           rendered="#{perNodeResult.errorState}">
  <h:outputText value="There was an error retrieving the results from this node.  The node may be down.  Please try again later."/>
</f:subview>
 
</f:subview>
</ui:composition>